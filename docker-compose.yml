services:

  uwsgi:
    build: .
    ports:
      - "8101:8101"
    volumes:
      - .:/app
    links:
      - nginx
    depends_on:
      - nginx
    command: make run-uwsgi

  fastapi:
    build: .
    ports:
      - "8102:8102"
    volumes:
      - .:/app
    links:
      - nginx
    depends_on:
      - nginx
    command: make run-fastapi

  aiohttp:
    build: .
    ports:
      - "8103:8103"
    volumes:
      - .:/app
    links:
      - nginx
    depends_on:
      - nginx
    command: make run-aiohttp
    environment:
      PORT: 8103
      LOOP_POLICY: uvloop.EventLoopPolicy

  fastapi-hypercorn:
    build: .
    ports:
      - "8104:8104"
    volumes:
      - .:/app
    links:
      - nginx
    depends_on:
      - nginx
    command: make run-fastapi-hypercorn
    environment:
      PORT: 8104

  nginx:
    image: nginx
    logging:
      driver: none
    volumes:
      - ./fixtures/:/usr/share/nginx/html:ro
    ports:
      - "8100:80"
